apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: matching-ingress
  annotations:
    # ì–´ë–¤ ë°œê¸‰ìë¥¼ í†µí•´ ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ì§€ ê²°ì •í•œë‹¤.
    cert-manager.io/cluster-issuer: selfsigned-cluster-issuer
    # SSE ì•ˆì •í™”ì— í•„ìˆ˜
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    # ğŸ”¸ ì›¹ì†Œì¼“ í•¸ë“œì…°ì´í¬ëŠ” HTTP/1.1 í•„ìš”
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
    nginx.ingress.kubernetes.io/enable-websocket: "true"
    nginx.ingress.kubernetes.io/affinity: "cookie"
    nginx.ingress.kubernetes.io/session-cookie-name: "INGRESS_STICKY"
    nginx.ingress.kubernetes.io/session-cookie-max-age: "86400"

spec:
  # ë¼ìš°íŒ… ê·œì¹™ì„ ì ìš©í•  ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì„ íƒí•œë‹¤.
  ingressClassName: nginx
  # ì¸ì¦ì„œë¥¼ ì ìš©í•  ë„ë©”ì¸ì„ ì„¤ì •í•œë‹¤.
  tls:
  - secretName: matching-tls-secret
    hosts:
    - matching-api.beyond.com
    - matching-app.beyond.com
  # í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ì˜ ë¼ìš°íŒ…(Host-Based Routing)
  # í•˜ë‚˜ì˜ ì¸ê·¸ë ˆìŠ¤ì—ì„œ ì—¬ëŸ¬ ë„ë©”ì¸ ì´ë¦„ì— ëŒ€í•´ ì„œë¡œ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ…í•œë‹¤.
  rules:
  - host: matching-api.beyond.com
    http: 
      paths:
      # PrefixëŠ” ì‚¬ìš©ìì˜ ìš”ì²­ ê²½ë¡œê°€ ì§€ì •ëœ ê²½ë¡œ(path)ë¡œ ì‹œì‘í•  ê²½ìš° ì¼ì¹˜í•œë‹¤.
      - pathType: Prefix
        # pathëŠ” ì‘ì„±í•œ ê²½ë¡œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ…í•œë‹¤.
        path: "/"
        # backendëŠ” ìš”ì²­ì„ ì „ë‹¬í•  ë‚´ë¶€ ì„œë¹„ìŠ¤ì™€ í¬íŠ¸ë¥¼ ì§€ì •í•œë‹¤.
        backend:
          service:
            name: matching-api-service
            port: 
              number: 8087
  - host: matching-app.beyond.com
    http:
      paths:
      - pathType: Prefix
        path: "/"
        backend:
          service:
            name: matching-vue-service
            port:
              number: 80
